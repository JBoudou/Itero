<ng-template #loadingTmpl>
  Loading...
</ng-template>

<ng-template #errorTmpl>
  <p i18n>Unexpected error {{ error.status }}: {{ error.message }}.</p>
</ng-template>

<div class="information-container" *ngIf="!error else errorTmpl">
  <div class="poll-main" *ngIf="!!answer else loadingTmpl">

    <div class="poll-information">
      <h3 class="poll-title">{{answer.Title}}</h3>
      <div class="poll-details">
        <p class="poll-description">{{answer.Description}}</p>
        <p class="poll-creation" i18n>Poll created by {{answer.Admin}} on {{answer.CreationTime | date}}.</p>
      </div>
    </div>

    <div class="poll-ballot" *ngIf="answer.Active">
      <h3 class="poll-round" i18n>
        {answer.CurrentRound, plural, =0 {First round} =1 {Second round} =2 {Third round} other {{{answer.CurrentRound + 1}}nd round}}
      </h3>
      <p class="previous-vote" *ngIf="hasCurrentRoundBallot()" i18n>
        On the current round, you've already voted <span class="vote">{{currentRoundBallot.asString}}</span>.
        You may now change this vote.
      </p>
      <p class="just-vote" *ngIf="hasJustVoteBallot()" i18n>
        Your
        <ng-container *ngIf="justVoteBallot.type == BallotType['Blank']">blank</ng-container>
        vote
        <ng-container *ngIf="justVoteBallot.type != BallotType['Blank']">
          for <span class="vote">{{justVoteBallot.asString}}</span>
        </ng-container>
        has been taken into account.
      </p>
      <ng-template PollBallot></ng-template>
    </div>
      
    <div class="poll-result" *ngIf="answer.CurrentRound > 0">
      <ng-template #finalTmpl>
        <h3 i18n>Final result</h3>
      </ng-template>
      <h3 class="poll-round" *ngIf="answer.Active else finalTmpl" i18n>
        {answer.CurrentRound, plural, =1 {First round} =2 {Second round} =3 {Third round} other {{{answer.CurrentRound}}nd round}}
      </h3>
      <p class="previous-vote" *ngIf="hasPreviousRoundBallot()" i18n>
        On the previous round, you voted <span class="vote">{{previousRoundBallot.asString}}</span>.
      </p>
      <ng-template PollInformation></ng-template>
    </div>

  </div>

  <div class="information" *ngIf="!!answer">
    
    <ng-template #terminatedTmpl>
      <p>
        Votes are now closed for this poll.
        The displayed result is the final one.
      </p>
    </ng-template>

    <ng-template #firstRoundTmpl>
      <p>
        This is the first round of the poll.
        <ng-container *ngIf="!hasCurrentRoundBallot()">
          You can submit a first ballot, in which case you will become a participant of the poll.
        </ng-container>
        In the next rounds, you will be able to change your vote, based on the results of the previous round.
        The first round will end
        <ng-container [ngSwitch]="roundDeadlinePassed()">
          <ng-container *ngSwitchCase="true">
            as soon as three participants has voted.
          </ng-container>
          <ng-container *ngSwitchCase="false">
            on {{ answer.RoundDeadline | date }}.
          </ng-container>
        </ng-container>
        <ng-container *ngIf="!hasCurrentRoundBallot()">
          It will not be possible to join the poll once the first round has ended.
        </ng-container>
        Then, each round will last {{ answer.MaxRoundDuration | duration }}, or until all participants have voted,
        whichever comes first.
      </p>
    </ng-template>

    <ng-template #minRoundTmpl>
      {answer.MinNbRounds, plural, =2 {second}, =3 {third}, other { {{answer.MinNbRounds + 1}}nd } } round.
    </ng-template>

    <ng-container *ngIf="answer.Active else terminatedTmpl">
      <p *ngIf="answer.CurrentRound > 0 else firstRoundTmpl">
        This is the
        {answer.CurrentRound, plural, =0 {first} =1 {second} =2 {third} other {{{answer.CurrentRound + 1}}nd}}
        round of the poll.
        You can now change your vote, based on the result of the previous round.
        If you do not vote until the end of the round, you will be considered as an abstentionist.
        The round will end on {{ answer.RoundDeadline | date }} or when all participants have voted,
        whichever comes first.
      </p>

      <p>
        The poll will end after the
        <ng-container *ngIf="!pollDeadlinePassed() else minRoundTmpl">
          {answer.MaxNbRounds, plural, =2 {second}, =3 {third} other {{{answer.MaxNbRounds + 1}}nd}} round, or
          <ng-container [ngSwitch]="answer.CurrentRound > answer.MinNbRounds">
            <ng-container *ngSwitchCase="true">
              on {{ answer.PollDeadline | date }}, wichever comes first.
            </ng-container>
            <ng-container *ngSwitchCase="false">
              after the 
              {answer.MinNbRounds, plural, =2 {second}, =3 {third} other {{{answer.MinNbRounds + 1}}nd}} round
              if that happens after {{ answer.PollDeadline | date }}.
            </ng-container>
          </ng-container>
        </ng-container>
      </p>
    </ng-container>

  </div>

</div>
